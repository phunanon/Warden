generator client {
  provider = "prisma-client-js"
  previewFeatures = ["typedSql"]
}

datasource db {
  provider = "sqlite"
  url      = "file:./db.db"
}

model Rule {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  guildSf   BigInt
  rule      String
}

model Message {
  id         Int      @id @default(autoincrement())
  at         DateTime @default(now())
  guildSf    BigInt
  channelSf  BigInt
  messageSf  BigInt
  authorSf   BigInt
  content    String
}

model Incident {
  id         Int      @id @default(autoincrement())
  at         DateTime @default(now())
  guildSf    BigInt
  channelSf  BigInt
  offenderSf BigInt
  messageSf  BigInt
  msgContent String
  categories String
  context    String
  resolution String?
  pardoned   Boolean  @default(false)

  groupInterventions  GroupIntervention[]
  victimInterventions VictimIntervention[]
  pardons             Pardon[]
  probations          Probation[]
  punishments         Punishment[]
}

model GroupIntervention {
  id         Int      @id @default(autoincrement())
  at         DateTime @default(now())
  incidentId Int
  rule       String
  msgDeleted Boolean

  incident Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)
}

model VictimIntervention {
  id         Int       @id @default(autoincrement())
  at         DateTime  @default(now())
  incidentId Int
  rule       String
  victimSf   BigInt
  pardonedAt DateTime?

  incident Incident @relation(fields: [incidentId], references: [id], onDelete: Cascade)
  Pardon   Pardon[]
}

model Pardon {
  id             Int      @id @default(autoincrement())
  at             DateTime @default(now())
  incidentId     Int
  interventionId Int

  incident     Incident           @relation(fields: [incidentId], references: [id], onDelete: Cascade)
  intervention VictimIntervention @relation(fields: [interventionId], references: [id], onDelete: Cascade)
}

model Probation {
  id                 Int      @id @default(autoincrement())
  at                 DateTime @default(now())
  originalIncidentId Int
  expiresAt          DateTime
  startInformed      Boolean  @default(false)
  endInformed        Boolean  @default(false)

  originalIncident Incident     @relation(fields: [originalIncidentId], references: [id], onDelete: Cascade)
  Punishment       Punishment[]
}

model Punishment {
  id               Int      @id @default(autoincrement())
  at               DateTime @default(now())
  probationId      Int
  secondIncidentId Int
  until            DateTime
  timeOut          Boolean
  ban              Boolean
  executed         Boolean  @default(false)

  probation      Probation @relation(fields: [probationId], references: [id], onDelete: Cascade)
  secondIncident Incident  @relation(fields: [secondIncidentId], references: [id], onDelete: Cascade)
  Parole         Parole[]
}

model Parole {
  id           Int      @id @default(autoincrement())
  at           DateTime @default(now())
  punishmentId Int
  expiresAt    DateTime

  punishment Punishment @relation(fields: [punishmentId], references: [id], onDelete: Cascade)
}
